<div *ngIf="loading()" class="text-center my-5">
  <div class="spinner-border" role="status">
    <span class="visually-hidden">Caricamento...</span>
  </div>
</div>
<div *ngIf="error()" class="alert alert-danger my-4">{{ error() }}</div>

<div *ngIf="!loading() && test() && questions().length" class="container">
  <h2 class="mb-4">{{ test()?.name }}</h2>
  <form (ngSubmit)="submit()">
    <div *ngFor="let q of questions(); let i = index" class="mb-4">
      <div class="card p-3">
        <div class="mb-2"><strong>Domanda {{ i + 1 }}:</strong></div>
        <div class="mb-2">{{ q.text }}</div>
        <ng-container [ngSwitch]="q.type">
          <!-- Scelta multipla -->
          <div *ngSwitchCase="'scelta multipla'">
            <div
              *ngFor="let opt of q.options; let oi = index"
              class="form-check"
            >
              <input
                class="form-check-input"
                type="radio"
                [name]="'q_' + q._id"
                [id]="'q_' + q._id + '_opt_' + oi"
                [checked]="isSelected(q._id, oi)"
                (change)="selectOption(q._id, oi)"
              />
              <label
                class="form-check-label"
                [for]="'q_' + q._id + '_opt_' + oi"
              >
                {{ opt.label }}
              </label>
            </div>
          </div>
          <!-- Vero/Falso -->
          <div *ngSwitchCase="'vero falso'">
            <div
              *ngFor="let opt of q.options; let oi = index"
              class="form-check"
            >
              <input
                class="form-check-input"
                type="radio"
                [name]="'q_' + q._id"
                [id]="'q_' + q._id + '_opt_' + oi"
                [checked]="isSelected(q._id, oi)"
                (change)="selectOption(q._id, oi)"
              />
              <label
                class="form-check-label"
                [for]="'q_' + q._id + '_opt_' + oi"
              >
                {{ opt.label }}
              </label>
            </div>
          </div>
          <!-- Risposta aperta -->
          <div *ngSwitchCase="'risposta aperta'">
            <textarea
              class="form-control"
              [name]="'q_' + q._id"
              [id]="'q_' + q._id + '_open'"
              rows="3"
              [(ngModel)]="answers()[q._id]"
              (ngModelChange)="selectOption(q._id, $event)"
              placeholder="Scrivi la tua risposta qui..."
            ></textarea>
          </div>
          <div *ngSwitchDefault>
            <em>Tipo domanda non supportato.</em>
          </div>
        </ng-container>
      </div>
    </div>
    <button type="submit" class="btn btn-primary mt-3">Invia risposte</button>
  </form>
</div>
