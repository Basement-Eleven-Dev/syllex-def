<select
  class="form-select mb-4 custom-input filter"
  [(ngModel)]="classSelected"
  style="max-width: 200px"
>
  <option [ngValue]="''">Tutte le classi</option>
</select>

<div class="row">
  <div class="col-6">
    <div class="card p-3 mb-4">
      <div class="card-body">
        <h5 class="text-dark fw-semibold mb-3">Distribuzione dei punteggi</h5>
        <canvas #scoreChart style="width: 100%; height: 400px"></canvas>
      </div>
    </div>
  </div>
  <div class="col-6 d-flex flex-column">
    <div class="card p-3 mb-4 flex-fill">
      <div class="card-body h-100">
        <h5 class="text-dark fw-semibold mb-3">Performance per argomento</h5>
        <div class="mb-3">
          <select
            class="form-select custom-input filter"
            [(ngModel)]="selectedTopic"
            (change)="onTopicChange()"
          >
            <option value="">Tutti gli argomenti</option>
            @for (topic of availableTopics; track topic) {
            <option [value]="topic">{{ topic }}</option>
            }
          </select>
        </div>
        <canvas #topicChart style="width: 100%; height: 200px"></canvas>
      </div>
    </div>
  </div>
</div>

<div class="card p-3">
  <div class="card-body">
    <h5 class="text-dark fw-semibold mb-3">Performance singole domande</h5>
    <div class="table-responsive">
      <table class="table table-striped table-hover align-middle">
        <thead>
          <tr>
            <th>#</th>
            <th class="text-muted fw-light">Domanda</th>
            <th class="text-center text-muted fw-light">Corrette</th>
            <th class="text-center text-muted fw-light">Errate</th>
            <th class="text-center text-muted fw-light">Vuote</th>
            <th class="text-center text-muted fw-light">Successo (%)</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          @for (stat of processedQuestions | slice: (page-1) * pageSize : page *
          pageSize; track $index) {
          <tr>
            <td>
              <span class="badge bg-dark"
                ># {{ ((page-1) * pageSize) + $index + 1 }}</span
              >
            </td>
            <td class="text-wrap" style="max-width: 300px">{{ stat.text }}</td>
            <td class="text-center text-success">{{ stat.correctCount }}</td>
            <td class="text-center text-danger">{{ stat.errorCount }}</td>
            <td class="text-center text-secondary">{{ stat.blankCount }}</td>
            <td class="text-center fw-bold">
              @if (stat.totalResponses > 0) { {{ ((stat.correctCount /
              stat.totalResponses) * 100).toFixed(1) }}% } @else { N/A }
            </td>
            <td>
              <button
                class="btn btn-sm btn-outline-primary"
                (click)="onRequestQuestionDetails(stat)"
              >
                <fa-icon [icon]="EyeIcon"></fa-icon>
              </button>
            </td>
          </tr>
          }
        </tbody>
      </table>
    </div>
  </div>
</div>

<div class="my-4 d-flex flex-row justify-content-between align-items-center">
  <app-syllex-pagination
    [collectionSize]="collectionSize"
    [(page)]="page"
    [pageSize]="pageSize"
    (pageChange)="onNewPageRequested()"
  />

  <select
    class="form-select form-select-sm custom-input"
    style="width: auto"
    [(ngModel)]="pageSize"
  >
    <option [ngValue]="5">5 per pagina</option>
    <option [ngValue]="10">10 per pagina</option>
  </select>
</div>
