<div class="h-100 card" style="width: 250px">
  <div class="w-100 px-3 py-4 d-flex flex-column h-100">
    <div
      class="card bg-secondary text-dark p-3 d-flex flex-column justify-content-center fw-bold overflow-hidden position-relative"
    >
      <div class="text-start">
        <a class="text-small opacity-75" (click)="onRequestSubjectSettings()">
          <fa-icon [icon]="GearIcon" class="text-dark" [size]="'1x'"></fa-icon>
        </a>
      </div>
      <h4 class="fw-bold mb-0">{{ selectedSubject?.name }}</h4>
      <div
        class="text-decoration-underline fw-light cursor-pointer d-flex flex-row justify-content-between align-items-center w-100 z-index-1 position-relative mb-1 small"
        style="z-index: 1"
        (click)="toggleSubjectsCollapse()"
        [attr.aria-expanded]="!isSubjectsCollapsed()"
        aria-controls="subjectsCollapse"
      >
        Cambia materia
      </div>

      <div
        #collapse="ngbCollapse"
        [ngbCollapse]="isSubjectsCollapsed()"
        (ngbCollapseChange)="isSubjectsCollapsed.set(!isSubjectsCollapsed())"
        id="subjectsCollapse"
      >
        <hr />
        <div class="mt-1 d-flex flex-column gap-2">
          @for(subject of availableSubjects(); track subject._id){
          <div
            class="p-2 fw-normal rounded-2 d-flex align-items-center gap-2 cursor-pointer materiaBtn d-flex flex-row justify-content-between align-items-center"
            [class.active]="selectedSubject?._id === subject._id"
            (click)="selectSubject(subject)"
            role="button"
          >
            <span class="text-truncate">{{ subject.name }} </span>
            <span class="status-pill warning"></span>
          </div>
          }
        </div>
      </div>
    </div>

    <div id="mainRoutes" class="d-flex flex-column gap-2 flex-fill mt-4">
      @for(route of mainRoutes; track $index){
      <div
        class="sidebarRoute w-100 gap-2 d-flex align-items-center"
        [routerLink]="route.path"
        routerLinkActive="active"
      >
        <fa-icon [icon]="route.icon"></fa-icon>
        <span class="routeLabel">{{route.label}}</span>
      </div>
      }
    </div>
    <div
      class="btn text-start ai d-flex flex-column justify-content-center position-relative py-4 mb-2"
      routerLink="/t/agente"
    >
      <fa-icon [icon]="HeadSideBrainIcon" id="sparkleIcon"></fa-icon>
      <h5 class="mb-0">Agente AI di {{ selectedSubject?.name }}</h5>
    </div>
    <div
      class="btn text-start ai d-flex flex-column justify-content-center position-relative py-4"
      routerLink="/t/laboratorio-ai"
    >
      <fa-icon [icon]="SparklesIcon" id="sparkleIcon"></fa-icon>
      <h5 class="mb-0">Laboratorio AI</h5>
    </div>
  </div>
</div>
