<div class="card border-0 shadow-sm rounded-4 mt-4">
  <div class="card-body p-4">
    <h5 class="fw-bold mb-4">
      <fa-icon [icon]="icons.faClipboardCheck" class="text-primary me-2"></fa-icon>
      Storico Test
    </h5>

    <div class="table-responsive">
      <table class="table table-hover align-middle">
        <thead class="bg-light">
          <tr>
            <th class="border-0 rounded-start">Test</th>
            <th class="border-0">Data Consegna</th>
            <th class="border-0">Punteggio</th>
            <th class="border-0">Stato</th>
            <th class="border-0 rounded-end text-end">Azioni</th>
          </tr>
        </thead>
        <tbody>
          @for (attempt of attempts; track attempt._id) {
            <tr>
              <td class="fw-bold">{{ attempt.testName }}</td>
              <td>
                <fa-icon [icon]="icons.faCalendarAlt" class="text-muted me-1 small"></fa-icon>
                {{ attempt.deliveredAt | date:'dd/MM/yyyy HH:mm' }}
              </td>
              <td>
                <span class="badge" [ngClass]="getScoreBadgeClass(attempt.score, attempt.maxScore)">
                  {{ attempt.score !== null ? attempt.score + '/' + attempt.maxScore : 'N/D' }}
                </span>
              </td>
              <td>
                <span class="badge rounded-pill" [ngClass]="getStatusBadgeClass(attempt.status)">
                  {{ attempt.status === 'reviewed' ? 'Corretto' : 'Da correggere' }}
                </span>
              </td>
              <td class="text-end">
                <a [routerLink]="['/t/correzione', attempt._id]" class="btn btn-sm btn-light rounded-pill">
                  <fa-icon [icon]="icons.faExternalLinkAlt" class="me-1"></fa-icon>
                  Vedi
                </a>
              </td>
            </tr>
          } @empty {
            <tr>
              <td colspan="5" class="text-center py-4 text-muted">
                Nessun test completato finora.
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>

    <!-- Paginazione -->
    @if (pagination && pagination.totalPages > 1) {
      <div class="d-flex justify-content-between align-items-center mt-4 pt-3 border-top">
        <div class="text-muted small">
          Pagina <strong>{{ pagination.page }}</strong> di <strong>{{ pagination.totalPages }}</strong>
          <span class="ms-2">({{ pagination.total }} risultati)</span>
        </div>
        <div class="btn-group">
          <button 
            type="button" 
            class="btn btn-outline-primary btn-sm rounded-start-pill px-3"
            [disabled]="pagination.page === 1"
            (click)="pageChange.emit(pagination.page - 1)">
            <fa-icon [icon]="icons.faChevronLeft" class="me-1"></fa-icon>
            Precedente
          </button>
          <button 
            type="button" 
            class="btn btn-outline-primary btn-sm rounded-end-pill px-3"
            [disabled]="pagination.page === pagination.totalPages"
            (click)="pageChange.emit(pagination.page + 1)">
            Successiva
            <fa-icon [icon]="icons.faChevronRight" class="ms-1"></fa-icon>
          </button>
        </div>
      </div>
    }
  </div>
</div>
