<div class="modal-header">
  <h5 class="modal-title">Modifica Password</h5>
  <button
    type="button"
    class="btn-close"
    aria-label="Close"
    (click)="onCancel()"
  ></button>
</div>

<div class="modal-body">
  <form [formGroup]="passwordForm" (ngSubmit)="onSubmit()">
    <div class="mb-3">
      <label for="oldPassword" class="form-label">Password Attuale</label>
      <div class="input-group">
        <input
          [type]="showOldPassword() ? 'text' : 'password'"
          class="form-control custom-input"
          id="oldPassword"
          formControlName="oldPassword"
          [class.is-invalid]="passwordForm.get('oldPassword')?.invalid && passwordForm.get('oldPassword')?.touched"
        />
        <button
          class="btn btn-outline-primary"
          type="button"
          (click)="togglePasswordVisibility('old')"
        >
          <fa-icon
            [icon]="showOldPassword() ? EyeSlashIcon : EyeIcon"
          ></fa-icon>
        </button>
      </div>
      @if (passwordForm.get('oldPassword')?.invalid &&
      passwordForm.get('oldPassword')?.touched) {
      <div class="text-danger small mt-1">
        La password attuale è obbligatoria
      </div>
      }
    </div>

    <div class="mb-3">
      <label for="newPassword" class="form-label">Nuova Password</label>
      <div class="input-group">
        <input
          [type]="showNewPassword() ? 'text' : 'password'"
          class="form-control custom-input"
          id="newPassword"
          formControlName="newPassword"
          [class.is-invalid]="passwordForm.get('newPassword')?.invalid && passwordForm.get('newPassword')?.touched"
        />
        <button
          class="btn btn-outline-primary"
          type="button"
          (click)="togglePasswordVisibility('new')"
        >
          <fa-icon
            [icon]="showNewPassword() ? EyeSlashIcon : EyeIcon"
          ></fa-icon>
        </button>
      </div>
      @if (passwordForm.get('newPassword')?.invalid &&
      passwordForm.get('newPassword')?.touched) {
      <div class="text-danger small mt-1">
        @if (passwordForm.get('newPassword')?.errors?.['required']) { La nuova
        password è obbligatoria } @if
        (passwordForm.get('newPassword')?.errors?.['minlength']) { La password
        deve essere di almeno 8 caratteri }
      </div>
      }
    </div>

    <div class="mb-3">
      <label for="confirmPassword" class="form-label"
        >Conferma Nuova Password</label
      >
      <div class="input-group">
        <input
          [type]="showConfirmPassword() ? 'text' : 'password'"
          class="form-control custom-input"
          id="confirmPassword"
          formControlName="confirmPassword"
          [class.is-invalid]="(passwordForm.get('confirmPassword')?.invalid || passwordForm.errors?.['passwordMismatch']) && passwordForm.get('confirmPassword')?.touched"
        />
        <button
          class="btn btn-outline-primary"
          type="button"
          (click)="togglePasswordVisibility('confirm')"
        >
          <fa-icon
            [icon]="showConfirmPassword() ? EyeSlashIcon : EyeIcon"
          ></fa-icon>
        </button>
      </div>
      @if (passwordForm.get('confirmPassword')?.touched) { @if
      (passwordForm.get('confirmPassword')?.errors?.['required']) {
      <div class="text-danger small mt-1">Conferma la nuova password</div>
      } @if (passwordForm.errors?.['passwordMismatch'] &&
      !passwordForm.get('confirmPassword')?.errors?.['required']) {
      <div class="text-danger small mt-1">Le password non coincidono</div>
      } }
    </div>

    @if (errorMessage()) {
    <div class="alert alert-danger" role="alert">{{ errorMessage() }}</div>
    }

    <div class="d-flex gap-2 justify-content-end">
      <button
        type="button"
        class="btn btn-secondary"
        (click)="onCancel()"
        [disabled]="isLoading()"
      >
        Annulla
      </button>
      <button
        type="submit"
        class="btn btn-primary"
        [disabled]="isLoading() || passwordForm.invalid"
      >
        @if (isLoading()) {
        <span
          class="spinner-border spinner-border-sm me-2"
          role="status"
          aria-hidden="true"
        ></span>
        } Conferma
      </button>
    </div>
  </form>
</div>
